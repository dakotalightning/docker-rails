db:
  image: mysql
  ports:
    - "13306:3306"
  environment:
    MYSQL_ROOT_PASSWORD: root

web:
  # build: dakotalightning/koda-rails
  build: .
  volumes:
    - .:/var/myapp
  ports:
    # "out/in"
    - "80:3000"
  links:
    - db
  # reference to https://github.com/docker/compose/issues/1393 where the pid isn't removed on cleanup
  command: bash -c "rm -f tmp/pids/server.pid && bundle exec rails s puma -b 0.0.0.0"
